<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: MVData/services/actions/google_action.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: MVData/services/actions/google_action.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>var Action, GoogleAction, _, _buildParams,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

Action = require('./action');

/**
 * Generate parameters for the request based on previous request data. Determines
 * whether to query only for the latest data, or to get the entire history.
 * 
 * @namespace GoogleAction
 * @private
 * @params {Object=} additionalParams   optional additional parameters
 * @return {Object}                     returns request parameters
*/


_buildParams = function(additionalParams) {
  var newerDate, params;
  params = _.clone(this.defaultParams);
  if (additionalParams != null) {
    _.extend(params, additionalParams);
  }
  /**
   * If we reached the end, and we have the latestActivity timestamp
   * then search for only for the newest items by adding an additional second
   * because otherwise it will return the latest item which we already have
  */

  if (this.requestData.end && this.requestData.latestActivity) {
    this.currentRequest = 'latest';
    newerDate = (new Date((new Date(this.requestData.latestActivity)).getTime() + 1000)).toISOString();
    params.publishedAfter = newerDate;
  }
  /**
   * If last request returned an error and we have the stamp from where we left off
   * then continue querying from there
  */

  if (this.requestData.error && this.requestData.oldestActivity) {
    params.publishedBefore = this.requestData.oldestActivity;
  }
  /**
   * Set now as the latest query timestamp
  */

  this.requestData.lastQuery = (new Date()).getTime();
  return params;
};

/**
 * Base class for Google Actions
 * Each Service under the immediate Google API umbrella such as Youtube and g+
 * are considered Actions because they're inside. They store their own
 * unique data inputs, but share the methods for storing data
 * 
 * @namespace GoogleAction
*/


module.exports = GoogleAction = (function(_super) {
  __extends(GoogleAction, _super);

  function GoogleAction(info) {
    GoogleAction.__super__.constructor.call(this, info);
    /**
     * The Google client returned after executing a discovery
     * @type {GoogleClient}
    */

    this.client = null;
  }

  /**
   * Builds a request for this action with it's parameters
   *
   * @param  {Object=}      additionalParams  optional additional parameters
   * @return {ClientRequest}
  */


  GoogleAction.prototype.prepareAction = function(additionalParams) {
    var params;
    params = _buildParams.call(this, additionalParams);
    return this.client[this.service][this.action][this.method](params);
  };

  return GoogleAction;

})(Action);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="DB.html">DB</a></li></ul><h3>Namespaces</h3><ul><li><a href="Action.html">Action</a></li><li><a href="DataCollector.html">DataCollector</a></li><li><a href="GoogleAction.html">GoogleAction</a></li><li><a href="history..html">Tweets
Generate parameters for the request based on previous request data. Determines
whether to query only for the latest data, or to get the entire history.</a></li><li><a href="tweets.html">Tweets
The action that gets and handles all tweets</a></li><li><a href="Twitter.html">Twitter</a></li><li><a href="Youtube.html">Youtube</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_oauthClientInit">_oauthClientInit</a></li><li><a href="global.html#accessToken">accessToken</a></li><li><a href="global.html#currentRequest">currentRequest</a></li><li><a href="global.html#decrement">decrement</a></li><li><a href="global.html#extendDefault">extendDefault</a></li><li><a href="global.html#increment">increment</a></li><li><a href="global.html#oauth2Client">oauth2Client</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0</a> on Thu Dec 05 2013 16:03:06 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
